# probr-core, django app
web:
   image: probr/core:latest
   command: sh install/docker/web/run.sh
   ports:
    - "8000:8000"
   links:
    - postgres
    - redis
    - mongodb

# probr-core, websockets
websocket:
   image: probr/core:latest
   command: uwsgi --socket :8001 --module probr.wsgi_websocket:application --enable-threads
   ports:
    - "8001:8001"
   links:
    - postgres
    - redis
    - mongodb

# probr-core, celery worker
worker:
   image: probr/core:latest
   command: celery worker -A probr
   links:
    - postgres
    - redis
    - mongodb

# database container
postgres:
   image: postgres:9.5
   volumes_from:
    - datapostgres
   environment:
      POSTGRES_USER: probr
      POSTGRES_PASSWORD: probr

# mongodb
mongodb:
  image: mongo:3.1.6
  volumes_from:
    - datamongodb

# redis container
redis:
   image: redis:2.8.19

# data container for postgres
datapostgres:
  image: cogniteev/echo
  volumes:
    - /var/lib/postgresql

# data container for mongodb
datamongodb:
  image: cogniteev/echo
  volumes:
    - /data/db
